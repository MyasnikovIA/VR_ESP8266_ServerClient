<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR MPU6050 Sensors Monitor</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px 0;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1, h2, h3 {
            margin-bottom: 15px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .status-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            margin: 0 5px;
        }
        
        .connected {
            background-color: var(--success-color);
            color: white;
        }
        
        .disconnected {
            background-color: var(--danger-color);
            color: white;
        }
        
        .devices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .device-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary-color);
        }
        
        .device-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .device-id {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .device-status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-connected {
            background: #d4edda;
            color: #155724;
        }
        
        .status-disconnected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .data-label {
            font-weight: bold;
            color: #666;
        }
        
        .data-value {
            font-weight: bold;
            color: #333;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .visualization {
            background-color: var(--secondary-color);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .visualization h3 {
            color: white;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .cube-container {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            perspective: 1000px;
        }
        
        .cube {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }
        
        .face {
            position: absolute;
            width: 200px;
            height: 200px;
            border: 2px solid #34495e;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            color: white;
            background: rgba(52, 152, 219, 0.8);
        }
        
        .front { transform: rotateY(0deg) translateZ(100px); background: rgba(231, 76, 60, 0.8); }
        .back { transform: rotateY(180deg) translateZ(100px); background: rgba(52, 152, 219, 0.8); }
        .right { transform: rotateY(90deg) translateZ(100px); background: rgba(46, 204, 113, 0.8); }
        .left { transform: rotateY(-90deg) translateZ(100px); background: rgba(155, 89, 182, 0.8); }
        .top { transform: rotateX(90deg) translateZ(100px); background: rgba(241, 196, 15, 0.8); }
        .bottom { transform: rotateX(-90deg) translateZ(100px); background: rgba(230, 126, 34, 0.8); }
        
        .device-controls {
            margin-top: 15px;
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .device-controls button {
            padding: 8px 12px;
            font-size: 12px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .notification.success {
            background-color: var(--success-color);
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .notification.info {
            background-color: var(--primary-color);
        }
        
        .connection-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .selected-device-info {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        
        .detail-cube-container {
            width: 250px;
            height: 250px;
            margin: 20px auto;
            perspective: 1000px;
        }
        
        .detail-cube {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }
        
        .detail-face {
            position: absolute;
            width: 250px;
            height: 250px;
            border: 3px solid #34495e;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            background: rgba(52, 152, 219, 0.8);
        }
        
        .detail-front { transform: rotateY(0deg) translateZ(125px); background: rgba(231, 76, 60, 0.8); }
        .detail-back { transform: rotateY(180deg) translateZ(125px); background: rgba(52, 152, 219, 0.8); }
        .detail-right { transform: rotateY(90deg) translateZ(125px); background: rgba(46, 204, 113, 0.8); }
        .detail-left { transform: rotateY(-90deg) translateZ(125px); background: rgba(155, 89, 182, 0.8); }
        .detail-top { transform: rotateX(90deg) translateZ(125px); background: rgba(241, 196, 15, 0.8); }
        .detail-bottom { transform: rotateX(-90deg) translateZ(125px); background: rgba(230, 126, 34, 0.8); }
        
        @media (max-width: 768px) {
            .devices-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ VR MPU6050 Sensors Monitor</h1>
            <p>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —Å–æ –≤—Å–µ—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–æ–≤ MPU6050 –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </header>
        
        <div class="card">
            <h2>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É</h2>
            <div class="connection-controls">
                <button class="btn-primary" id="connect-btn">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É</button>
                <button class="btn-danger" id="disconnect-btn" disabled>–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
                <button class="btn-warning" id="reconnect-btn">–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
                <button class="btn-success" id="refresh-btn" disabled>–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            </div>
            
            <div class="status-bar">
                <div class="status-item" id="server-status">
                    –°–µ—Ä–≤–µ—Ä: –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
                </div>
                <div class="status-item" id="devices-count">
                    –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: 0
                </div>
                <div class="status-item" id="last-update">
                    –û–±–Ω–æ–≤–ª–µ–Ω–æ: -
                </div>
            </div>
        </div>

        <div class="card">
            <h2>–ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h2>
            <div class="devices-grid" id="devices-container">
                <!-- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                <div class="device-card">
                    <div class="device-header">
                        <div class="device-id">–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</div>
                        <div class="device-status status-disconnected">Offline</div>
                    </div>
                    <div class="data-grid">
                        <div class="data-item"><span class="data-label">Pitch:</span><span class="data-value">0.0¬∞</span></div>
                        <div class="data-item"><span class="data-label">Roll:</span><span class="data-value">0.0¬∞</span></div>
                        <div class="data-item"><span class="data-label">Yaw:</span><span class="data-value">0.0¬∞</span></div>
                        <div class="data-item"><span class="data-label">Rel Pitch:</span><span class="data-value">0.00¬∞</span></div>
                        <div class="data-item"><span class="data-label">Rel Roll:</span><span class="data-value">0.00¬∞</span></div>
                        <div class="data-item"><span class="data-label">Rel Yaw:</span><span class="data-value">0.00¬∞</span></div>
                    </div>
                    <div class="visualization">
                        <h3>3D –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç—á–∏–∫–∞</h3>
                        <div class="cube-container">
                            <div class="cube">
                                <div class="face front">FRONT</div>
                                <div class="face back">BACK</div>
                                <div class="face right">RIGHT</div>
                                <div class="face left">LEFT</div>
                                <div class="face top">TOP</div>
                                <div class="face bottom">BOTTOM</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h2>
            <div id="event-log" style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 5px; font-size: 14px;">
                <div>–ì–æ—Ç–æ–≤ –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é...</div>
            </div>
        </div>
    </div>

    <script>
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        let webSocket = null;
        let isConnected = false;
        let lastUpdateTime = null;
        let selectedDeviceId = null;
        
        // –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        let devicesData = {};
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const connectBtn = document.getElementById('connect-btn');
        const disconnectBtn = document.getElementById('disconnect-btn');
        const reconnectBtn = document.getElementById('reconnect-btn');
        const refreshBtn = document.getElementById('refresh-btn');
        const serverStatusElement = document.getElementById('server-status');
        const devicesCountElement = document.getElementById('devices-count');
        const lastUpdateElement = document.getElementById('last-update');
        const eventLogElement = document.getElementById('event-log');
        const devicesContainer = document.getElementById('devices-container');
        const selectedDeviceInfo = document.getElementById('selected-device-info');
        const detailCube = document.getElementById('detail-cube');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            connectBtn.addEventListener('click', connectToServer);
            disconnectBtn.addEventListener('click', disconnectFromServer);
            reconnectBtn.addEventListener('click', reconnectToServer);
            refreshBtn.addEventListener('click', refreshData);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–≥
            addToLog('–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –ì–æ—Ç–æ–≤ –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é.');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            updateConnectionStatus(false);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function connectToServer() {
            if (isConnected) {
                showNotification('–£–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É', 'info');
                return;
            }
            
            const serverUrl = 'ws://192.168.4.1:81/';
            webSocket = new WebSocket(serverUrl);
            
            webSocket.onopen = function() {
                isConnected = true;
                updateConnectionStatus(true);
                showNotification('–£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É', 'success');
                addToLog('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: ' + serverUrl);
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                sendCommand('GET_ALL_DATA');
            };
            
            webSocket.onmessage = function(event) {
                processServerData(event.data);
                lastUpdateTime = new Date();
                updateLastUpdateTime();
            };
            
            webSocket.onclose = function() {
                isConnected = false;
                updateConnectionStatus(false);
                showNotification('–û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞', 'error');
                addToLog('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º —Ä–∞–∑–æ—Ä–≤–∞–Ω–æ');
            };
            
            webSocket.onerror = function(error) {
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                addToLog('–û—à–∏–±–∫–∞ WebSocket: ' + error);
            };
        }
        
        function disconnectFromServer() {
            if (webSocket) {
                webSocket.close();
                webSocket = null;
            }
            isConnected = false;
            updateConnectionStatus(false);
            addToLog('–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
        }
        
        function reconnectToServer() {
            disconnectFromServer();
            setTimeout(connectToServer, 1000);
        }
        
        function refreshData() {
            if (isConnected && webSocket) {
                sendCommand('GET_ALL_DATA');
                addToLog('–ó–∞–ø—Ä–æ—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
            }
        }
        
        function updateConnectionStatus(connected) {
            if (connected) {
                serverStatusElement.textContent = '–°–µ—Ä–≤–µ—Ä: –ü–æ–¥–∫–ª—é—á–µ–Ω';
                serverStatusElement.className = 'status-item connected';
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
                refreshBtn.disabled = false;
            } else {
                serverStatusElement.textContent = '–°–µ—Ä–≤–µ—Ä: –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω';
                serverStatusElement.className = 'status-item disconnected';
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
                refreshBtn.disabled = true;
            }
        }
        
        function updateLastUpdateTime() {
            if (lastUpdateTime) {
                lastUpdateElement.textContent = '–û–±–Ω–æ–≤–ª–µ–Ω–æ: ' + lastUpdateTime.toLocaleTimeString();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
        function processServerData(data) {
            try {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
                if (data.startsWith('CLIENT:')) {
                    parseClientData(data);
                }
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
                else if (data.includes('SERVER:') || 
                         data.includes('DATA_RECEIVED:')) {
                    handleStatusMessage(data);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                addToLog('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
            }
        }
        
        function parseClientData(dataString) {
            const data = {};
            
            // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –∫–ª—é—á:–∑–Ω–∞—á–µ–Ω–∏–µ
            const pairs = dataString.split(',');
            pairs.forEach(pair => {
                const [key, value] = pair.split(':');
                if (key && value !== undefined) {
                    data[key.trim()] = value.trim();
                }
            });
            
            const deviceId = data.CLIENT;
            if (!deviceId) return;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            if (!devicesData[deviceId]) {
                devicesData[deviceId] = {
                    deviceId: deviceId,
                    pitch: 0,
                    roll: 0,
                    yaw: 0,
                    relPitch: 0,
                    relRoll: 0,
                    relYaw: 0,
                    zeroSet: false,
                    lastUpdate: new Date(),
                    cubeElement: null
                };
                addToLog('–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ' + deviceId);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            if (data.PITCH) devicesData[deviceId].pitch = parseFloat(data.PITCH);
            if (data.ROLL) devicesData[deviceId].roll = parseFloat(data.ROLL);
            if (data.YAW) devicesData[deviceId].yaw = parseFloat(data.YAW);
            if (data.REL_PITCH) devicesData[deviceId].relPitch = parseFloat(data.REL_PITCH);
            if (data.REL_ROLL) devicesData[deviceId].relRoll = parseFloat(data.REL_ROLL);
            if (data.REL_YAW) devicesData[deviceId].relYaw = parseFloat(data.REL_YAW);
            if (data.ZERO_SET) devicesData[deviceId].zeroSet = (data.ZERO_SET === 'true');
            devicesData[deviceId].lastUpdate = new Date();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateDevicesDisplay();
            updateDevicesCount();
            
            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
            if (selectedDeviceId === deviceId) {
                updateSelectedDeviceVisualization();
            }
        }
        
        function handleStatusMessage(message) {
            if (message.includes('SERVER:')) {
                addToLog('–°–µ—Ä–≤–µ—Ä: ' + message.substring(7));
            } else if (message.includes('DATA_RECEIVED:')) {
                addToLog('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –æ—Ç: ' + message.substring(14));
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateDevicesDisplay() {
            devicesContainer.innerHTML = '';
            
            if (Object.keys(devicesData).length === 0) {
                devicesContainer.innerHTML = `
                    <div class="device-card">
                        <div class="device-header">
                            <div class="device-id">–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</div>
                            <div class="device-status status-disconnected">Offline</div>
                        </div>
                        <div class="data-grid">
                            <div class="data-item"><span class="data-label">Pitch:</span><span class="data-value">0.0¬∞</span></div>
                            <div class="data-item"><span class="data-label">Roll:</span><span class="data-value">0.0¬∞</span></div>
                            <div class="data-item"><span class="data-label">Yaw:</span><span class="data-value">0.0¬∞</span></div>
                        </div>
                        <div class="visualization">
                            <h3>3D –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç—á–∏–∫–∞</h3>
                            <div class="cube-container">
                                <div class="cube">
                                    <div class="face front">FRONT</div>
                                    <div class="face back">BACK</div>
                                    <div class="face right">RIGHT</div>
                                    <div class="face left">LEFT</div>
                                    <div class="face top">TOP</div>
                                    <div class="face bottom">BOTTOM</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            for (const deviceId in devicesData) {
                const device = devicesData[deviceId];
                const isSelected = deviceId === selectedDeviceId;
                const cardStyle = isSelected ? 'border-left: 4px solid var(--success-color);' : '';
                
                const deviceCard = document.createElement('div');
                deviceCard.className = 'device-card';
                deviceCard.style = cardStyle;
                deviceCard.innerHTML = `
                    <div class="device-header">
                        <div class="device-id">${device.deviceId}</div>
                        <div class="device-status status-connected">Online</div>
                    </div>
                    <div class="data-grid">
                        <div class="data-item"><span class="data-label">Pitch:</span><span class="data-value">${device.pitch.toFixed(1)}¬∞</span></div>
                        <div class="data-item"><span class="data-label">Roll:</span><span class="data-value">${device.roll.toFixed(1)}¬∞</span></div>
                        <div class="data-item"><span class="data-label">Yaw:</span><span class="data-value">${device.yaw.toFixed(1)}¬∞</span></div>
                        <div class="data-item"><span class="data-label">Rel Pitch:</span><span class="data-value">${device.relPitch.toFixed(2)}¬∞</span></div>
                        <div class="data-item"><span class="data-label">Rel Roll:</span><span class="data-value">${device.relRoll.toFixed(2)}¬∞</span></div>
                        <div class="data-item"><span class="data-label">Rel Yaw:</span><span class="data-value">${device.relYaw.toFixed(2)}¬∞</span></div>
                    </div>
                    <div class="visualization">
                        <h3>3D –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç—á–∏–∫–∞</h3>
                        <div class="cube-container">
                            <div class="cube" id="cube-${deviceId}">
                                <div class="face front">FRONT</div>
                                <div class="face back">BACK</div>
                                <div class="face right">RIGHT</div>
                                <div class="face left">LEFT</div>
                                <div class="face top">TOP</div>
                                <div class="face bottom">BOTTOM</div>
                            </div>
                        </div>
                    </div>
                    <div class="device-controls">
                        <button class="btn-primary" onclick="selectDevice('${deviceId}')">–í—ã–±—Ä–∞—Ç—å</button>
                        <button class="btn-success" onclick="sendDeviceCommand('${deviceId}', 'SET_ZERO')">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–ª—å</button>
                        <button class="btn-warning" onclick="sendDeviceCommand('${deviceId}', 'RECALIBRATE')">–ö–∞–ª–∏–±—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn-danger" onclick="sendDeviceCommand('${deviceId}', 'RESET_ANGLES')">–°–±—Ä–æ—Å–∏—Ç—å</button>
                    </div>
                `;
                
                devicesContainer.appendChild(deviceCard);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç –∫—É–±–∞
                devicesData[deviceId].cubeElement = document.getElementById(`cube-${deviceId}`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –∫—É–±–∞
                updateDeviceCubeVisualization(deviceId);
            }
        }
        
        function updateDeviceCubeVisualization(deviceId) {
            const device = devicesData[deviceId];
            const cubeElement = device.cubeElement;
            
            if (cubeElement) {
                cubeElement.style.transform = `rotateX(${device.roll}deg) rotateY(${device.yaw}deg) rotateZ(${device.pitch}deg)`;
            }
        }
        
        function updateSelectedDeviceVisualization() {
            if (!selectedDeviceId || !devicesData[selectedDeviceId]) {
                selectedDeviceInfo.innerHTML = `
                    <div><strong>–í—ã–±–µ—Ä–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</strong></div>
                `;
                detailCube.style.transform = 'rotateX(0deg) rotateY(0deg) rotateZ(0deg)';
                return;
            }
            
            const device = devicesData[selectedDeviceId];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
            selectedDeviceInfo.innerHTML = `
                <div><strong>ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</strong> ${device.deviceId}</div>
                <div><strong>–¢–∏–ø —Å–µ–Ω—Å–æ—Ä–∞:</strong> MPU6050</div>
                <div><strong>–ù–æ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:</strong> <span style="color: ${device.zeroSet ? 'var(--success-color)' : 'var(--danger-color)'}">${device.zeroSet ? '–î–∞' : '–ù–µ—Ç'}</span></div>
                <div><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> ${device.lastUpdate.toLocaleTimeString()}</div>
            `;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
            detailCube.style.transform = `rotateX(${device.roll}deg) rotateY(${device.yaw}deg) rotateZ(${device.pitch}deg)`;
        }
        
        function updateDevicesCount() {
            const count = Object.keys(devicesData).length;
            devicesCountElement.textContent = `–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: ${count}`;
        }
        
        function selectDevice(deviceId) {
            selectedDeviceId = deviceId;
            updateDevicesDisplay();
            updateSelectedDeviceVisualization();
            addToLog('–í—ã–±—Ä–∞–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ' + deviceId);
        }

        // –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function sendCommand(command) {
            if (isConnected && webSocket) {
                webSocket.send('CMD:' + command);
            }
        }
        
        function sendDeviceCommand(deviceId, command) {
            if (isConnected && webSocket) {
                webSocket.send('CMD:SEND_TO_DEVICE:' + deviceId + ':' + command);
                addToLog(`–ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É ${deviceId}: ${command}`);
            } else {
                showNotification('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        function addToLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            
            eventLogElement.appendChild(logEntry);
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
            eventLogElement.scrollTop = eventLogElement.scrollHeight;
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ª–æ–≥–µ
            if (eventLogElement.children.length > 50) {
                eventLogElement.removeChild(eventLogElement.firstChild);
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        setInterval(updateLastUpdateTime, 1000);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        setInterval(() => {
            if (isConnected) {
                sendCommand('GET_ALL_DATA');
            }
        }, 2000);
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        window.addEventListener('load', init);
    </script>
</body>
</html>